{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Generates Alerts for OS Credential Dumping",
    "aliasName": null,
    "tag": null,
    "description": "Create alert for non-Windows processes accessing the lsass.exe process, which can be indicative of credential dumping",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "lastModifyDate": 1639752713,
    "collection": "\/api\/3\/workflow_collections\/2d31bc0f-81b6-482b-91ac-2629def1c7ac",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/f1e61b9a-ccd6-48ae-aac6-2f01f79b5553",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "step_variables": {
                    "input": {
                        "params": []
                    }
                }
            },
            "status": null,
            "top": "30",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "uuid": "f1e61b9a-ccd6-48ae-aac6-2f01f79b5553",
            "id": 5555
        },
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "scenarioTitle": "{{vars.input.records[0].title}}",
                "useMockOutput": "true"
            },
            "status": null,
            "top": "165",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "uuid": "a2d9f683-6e8a-46e7-b312-731dbb700ca4",
            "id": 5556
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Alert from SIEM",
            "description": null,
            "arguments": {
                "arguments": {
                    "huntEnd": "{{arrow.get(vars.steps.Get_Hunt_Time_Range.input.huntEndDate).int_timestamp}}",
                    "huntStart": "{{arrow.get(vars.steps.Get_Hunt_Time_Range.input.huntStartDate).int_timestamp}}"
                },
                "apply_async": false,
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/81afad73-c03f-4830-97e8-6d28d716ea73"
            },
            "status": null,
            "top": "570",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "f7e089c2-4fda-4941-99f9-5c2fa3b968bc",
            "id": 5557
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Created Alert Data",
            "description": null,
            "arguments": {
                "@id": "{{(vars.steps.Create_and_Link_Alert | json_query('[].alert_data.\"@id\"')) | union([vars.steps.Create_Hunt_Record['@id']])}}"
            },
            "status": null,
            "top": "840",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "uuid": "e963fd67-62fb-4d6a-8889-e8a9faf1063e",
            "id": 5558
        },
        {
            "@type": "WorkflowStep",
            "name": "Get Hunt Time Range",
            "description": null,
            "arguments": {
                "type": "InputBased",
                "input": {
                    "schema": {
                        "title": "Enter Hunt Time Range",
                        "description": "Hunt Time Range",
                        "inputVariables": [
                            {
                                "name": "huntStartDate",
                                "type": "integer",
                                "label": "Hunt Start Date",
                                "title": "Date\/Time Field",
                                "usable": true,
                                "tooltip": "",
                                "dataType": "datetime",
                                "formType": "datetime",
                                "required": true,
                                "_expanded": true,
                                "mmdUpdate": true,
                                "collection": false,
                                "searchable": true,
                                "templateUrl": "app\/components\/form\/fields\/datetime.html",
                                "defaultValue": {
                                    "differenceType": "months",
                                    "differenceValue": -1
                                },
                                "_previousName": "untStartDate",
                                "lengthConstraint": false,
                                "allowedEncryption": false,
                                "allowedGridColumn": true,
                                "useRecordFieldDefault": false
                            },
                            {
                                "name": "huntEndDate",
                                "type": "integer",
                                "label": "Hunt End Date",
                                "title": "Date\/Time Field",
                                "usable": true,
                                "tooltip": "",
                                "dataType": "datetime",
                                "formType": "datetime",
                                "required": true,
                                "_expanded": true,
                                "mmdUpdate": true,
                                "collection": false,
                                "searchable": true,
                                "templateUrl": "app\/components\/form\/fields\/datetime.html",
                                "defaultValue": {
                                    "differenceType": "mins",
                                    "differenceValue": 1
                                },
                                "_previousName": "huntStartDate",
                                "lengthConstraint": false,
                                "allowedEncryption": false,
                                "allowedGridColumn": true,
                                "useRecordFieldDefault": false
                            }
                        ]
                    }
                },
                "record": "{{vars.input.records[0]['@id']}}",
                "resources": "scenario",
                "owner_detail": {
                    "isAssigned": false
                },
                "step_variables": [],
                "response_mapping": {
                    "options": [
                        {
                            "option": "Submit",
                            "primary": true,
                            "step_iri": "\/api\/3\/workflow_steps\/302dee88-091d-49c4-9d33-df82b6cfdd9d"
                        }
                    ],
                    "duplicateOption": false
                },
                "email_notification": {
                    "enabled": false,
                    "smtpParameters": []
                }
            },
            "status": null,
            "top": "300",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/fc04082a-d7dc-4299-96fb-6837b1baa0fe",
            "uuid": "858a8ed4-9147-4a22-be97-8629a81925df",
            "id": 5559
        },
        {
            "@type": "WorkflowStep",
            "name": "Create and Link Alert",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.steps.Get_Alert_from_SIEM.step_output}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "MD5": "{{ (vars.item._source.event_data.Hashes.split(\"MD5=\")[1].split(',')[0])}}",
                    "url": "",
                    "source": "{{vars.item._source.source_name}}",
                    "comment": "SIEM query identified process {{vars.item._source.image_path.split(\"\\\\\")[-1] }} attempting to access LSASS on host {{vars.item._source.beat.hostname}} at {{ vars.item._source.event_data.UtcTime}}.",
                    "huntIRI": "{{vars.steps.Create_Hunt_Record['@id']}}",
                    "service": "",
                    "filePath": "{{vars.item._source.image_path}}",
                    "hostName": "{{vars.item._source.beat.hostname}}",
                    "sourceIP": "",
                    "userName": "{{vars.item._source.username}}",
                    "alertName": "ATT&CK-Credential Access-LSASS accessed by {{vars.item._source.image_path.split(\"\\\\\")[-1] }}",
                    "alertType": "{{\"AlertType\" | picklist(\"OS Credential Dumping\", \"@id\")}}",
                    "epochTime": "{{ arrow.get(vars.item._source.event_data.UtcTime).timestamp }}",
                    "eventName": "",
                    "eventTime": "{{ vars.item._source.event_data.UtcTime}}",
                    "processID": "{{vars.item._source.event_data.ProcessId}}",
                    "technique": "LSASS Access",
                    "sourceData": "{{vars.item}}",
                    "sourceTool": "{{vars.item._source.source_name}}",
                    "commandline": "{{vars.item._source.event_data.CommandLine}}",
                    "description": "An attempt to access lsass.exe by a non-standard process was observed. LSASS.exe stores Windows login credentials. Access of lsass.exe by non-standard processes may indicate that a process is attempting to dump or access credentials stored by the lsass process.",
                    "processGUID": "{{vars.item._source.event_data.ProcessGuid}}",
                    "processName": "{{vars.item._source.image_path.split(\"\\\\\")[-1] }}",
                    "registryKey": "",
                    "sourceImage": "{{ vars.item._source.event_data.SourceImage | replace( \"\\\\\", \"\\\\\\\\\" )}}",
                    "targetImage": "{{ vars.item._source.event_data.TargetImage | replace( \"\\\\\", \"\\\\\\\\\" )}}",
                    "computerName": "{{vars.item._source.computer_name}}",
                    "destinationIP": "",
                    "mitre_tech_id": "T1003.001",
                    "parentProcess": "",
                    "scheduledTask": "",
                    "bitstransferid": "",
                    "parentProcessID": "",
                    "bytestransferred": "",
                    "registryKeyValue": "",
                    "parentCommandLine": "",
                    "decodedCommandLine": ""
                },
                "apply_async": false,
                "step_variables": [],
                "workflowReference": "\/api\/3\/workflows\/777da1e4-a67c-471d-b29e-9ee05643e256"
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "uuid": "ecb626a2-d768-4be6-bec9-80fb246ca90f",
            "id": 5580
        },
        {
            "@type": "WorkflowStep",
            "name": "Create Hunt Record",
            "description": null,
            "arguments": {
                "resource": {
                    "name": "Demo Hunt - {{vars.scenarioTitle}}",
                    "huntEnd": "{{arrow.get(vars.steps.Get_Hunt_Time_Range.input.huntEndDate).int_timestamp}}",
                    "__replace": "",
                    "huntStart": "{{arrow.get(vars.steps.Get_Hunt_Time_Range.input.huntStartDate).int_timestamp}}",
                    "timeCreated": "{{arrow.utcnow().int_timestamp}}"
                },
                "_showJson": false,
                "operation": "Overwrite",
                "collection": "\/api\/3\/hunt",
                "__recommend": [],
                "fieldOperation": {
                    "recordTags": "Overwrite"
                },
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/2597053c-e718-44b4-8394-4d40fe26d357",
            "uuid": "302dee88-091d-49c4-9d33-df82b6cfdd9d",
            "id": 5901
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/a2d9f683-6e8a-46e7-b312-731dbb700ca4",
            "sourceStep": "\/api\/3\/workflow_steps\/f1e61b9a-ccd6-48ae-aac6-2f01f79b5553",
            "label": null,
            "isExecuted": false,
            "uuid": "94128d5e-12d6-4d2a-9b07-15fa3e8bab4f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get Hunt Time Range",
            "targetStep": "\/api\/3\/workflow_steps\/858a8ed4-9147-4a22-be97-8629a81925df",
            "sourceStep": "\/api\/3\/workflow_steps\/a2d9f683-6e8a-46e7-b312-731dbb700ca4",
            "label": null,
            "isExecuted": false,
            "uuid": "e9575441-024c-4a0f-8e08-1069e2595397"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Alert from SIEM -> Create Alerts from Elastic",
            "targetStep": "\/api\/3\/workflow_steps\/ecb626a2-d768-4be6-bec9-80fb246ca90f",
            "sourceStep": "\/api\/3\/workflow_steps\/f7e089c2-4fda-4941-99f9-5c2fa3b968bc",
            "label": null,
            "isExecuted": false,
            "uuid": "4ae5a15f-5c71-4c97-83f7-cba5418e2c9a"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Alerts from Elastic -> Get Created Alert Data",
            "targetStep": "\/api\/3\/workflow_steps\/e963fd67-62fb-4d6a-8889-e8a9faf1063e",
            "sourceStep": "\/api\/3\/workflow_steps\/ecb626a2-d768-4be6-bec9-80fb246ca90f",
            "label": null,
            "isExecuted": false,
            "uuid": "e7fa804c-324d-4202-9e07-f0e1cda0e984"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get Hunt Time Range -> Create Hunt Record",
            "targetStep": "\/api\/3\/workflow_steps\/302dee88-091d-49c4-9d33-df82b6cfdd9d",
            "sourceStep": "\/api\/3\/workflow_steps\/858a8ed4-9147-4a22-be97-8629a81925df",
            "label": "Submit",
            "isExecuted": false,
            "uuid": "7e756614-852e-4608-8c27-629a0708e596"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Create Hunt Record -> Get Alert from SIEM",
            "targetStep": "\/api\/3\/workflow_steps\/f7e089c2-4fda-4941-99f9-5c2fa3b968bc",
            "sourceStep": "\/api\/3\/workflow_steps\/302dee88-091d-49c4-9d33-df82b6cfdd9d",
            "label": null,
            "isExecuted": false,
            "uuid": "3c5ad889-6c83-4205-bd1a-d6b38362e1f4"
        }
    ],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "0f7279b8-976a-4664-99bc-9cb10f5faa52",
    "recordTags": [],
    "id": 1348,
    "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
    "createDate": 1638886865,
    "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
    "modifyDate": 1640012910,
    "owners": [],
    "isPrivate": false
}